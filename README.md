# The Phonwork Project

This repository contains templates for generating a customizable on-line Phonetics Workbook.  See a version of the site that includes all of the exercises at https://linguistics.berkeley.edu/phonwork

The aim is to create an open-access phonetics workbook using a framework that makes it possible for phoneticians to make contributions to the workbook, and to post a customized workbook of selected exercises. Phonetics teachers around the world produce excellent phonetics exercises for their classes.  This project hopes to facilitate the sharing of teaching materials, by making a broad and deep range of materials available in an open-access format.

## The approach

Phonwork is a *framework* for producing and presenting phonetics exercises, and an *initial bank of exercises*.  The elements of the framework are relatively modular and extensible.  The **graphic user interface** is from the "Phantom" template by HTML5up.net, and can be replaced by other GUI frameworks.  The **javascript** functions to power the question/answer format of the exercises are in the file *exercises.js*. This is a lean but general javascript framework that makes it possible to write new exercises without needing to write any new javascript. Much of the **initial bank of exercises** are drawn from the exercises for Ladefoged's "A Course in Phonetics" which is also hosted at UC Berkeley (https://linguistics.berkeley.edu/acip).  This project grew out of the experience of creating the "Course" site.  The **framework** of page templates and python scripts to generate the site allows for changes in contents and organization to be incorporated quickly and easily and allows for the creation of local variants of the site. **Media files** in the initial bank of exercises are hosted by UC Berkeley on AWS, to increase the worldwide responsiveness of the page.  With permission, contributors' audio and video can also be hosted in this way.

## Getting started

To get started with this repository, clone it:

```bash
git clone https://github.com/PhonWork/phonwork
```

The site is generated by a Python script with minimal dependencies. The
only required package that is not in the standard library is
[jinja2](https://jinja.palletsprojects.com/en/3.0.x/). Install it before
trying to generate the site.

## Editing and building the site

See the [Phonwork Manual](manual_for_exercises_javascript.md) for details on how to create or modify exercises in this framework, and on how to create a custom on-line phonetics workbook.

Templates for the site pages are in the `templates` directory. Templates
with filenames beginning with an alphabetic character are rendered as content
pages that use the overall layout determined by `_base_page.html`. Other
templates beginning with underscore (such as '_header.html', '_footer.html', and '_menu.html') are used to include sublayouts and
are not rendered as separate HTML files.

To generate the site, do:

```bash
cd scripts
python generate.py
```

The content pages will be rendered to HTML files in the `site` directory.
Before the pages are generated the existing `site` directory will be
cleared of existing content.

## Media Submodules ##

Many of the media files used in PhonWork are licensed with different copyright restrictions on usage. For this reason, we are using submodules to store media based on copyright status. However, the symbolic link to the submodules within the main Github repository will not update when new media is added to a submodule.

To fix this, run

```bash
git submodule update
```

## Viewing the site

Use your web browser to open the files in the `site` directory to view
the current website.

## Updating the repo

If the results of viewing the site are satisfactory, push the changes to
Github and then copy the current site files to the public server. A sample
set of commands:

```bash
# View repo status
git status

# Inspect, commit, and push changes
git diff templates/mypage.html
git add templates/mypage.html
git commit -m 'Added a section to mypage.html'
git push

# Copy site files to public server
scp -R site/* username@server.com:/sites/phonwork
```

## Building the site for deployment to a public server

A GitHub Action can be used to build the site on GitHub and push the result
to a specific branch. When the Action completes you can pull the branch to
your server.

1. Log in to GitHub.
1. Find the [`Build phonwork website and deploy to a site-* branch` workflow](https://github.com/PhonWork/phonwork/actions/workflows/publish.yaml) under the Actions tab.
1. Click on the `Run workflow` button.
1. Choose the branch you would like to push to, either `site-dev` (development version) or `site-prod` (production).
1. Click 'Run workflow`.

When the workflow completes successfully pull the branch to your server:

1. Log in to your server.
1. Navigate to the directory where the repository branch has been cloned (`site-dev` or `site-prod`).
1. Give the command `git pull origin --rebase --allow-unrelated-histories`.

The `git pull ...` command assumes that the repository branch has already been
cloned on your server, and that you have also configured your web server to
use the cloned repository branch. As a one-time setup step you can clone
the branches on your server with:

```bash
mkdir phonwork
cd phonwork
git clone -b site-dev https://github.com/PhonWork/phonwork site-dev  # Development site
git clone -b site-prod https://github.com/PhonWork/phonwork site-prod  # Production site
```

Then configure your web server to use the cloned `site-dev` and `site-prod`
directories. **It is also recommended to disallow access to the `.git`
subdirectories in your server configuration.**

